# Antarctica_scripts
Scripts used as part of metagenome/16S data analysis. These are made available for transparency, and for the benefit of others who may find themselves performing similar analyses.

Contained within this repository are scripts used for the analysis of a project currently titled "A Metagenomic Profile of Antarctica's Microbiome Reveals Effects Mediated by Human Sewage Outflow into the Southern Ocean". Scripts are partitioned into 8 folders to enable easier retrieval of scripts related to each part of the project.

## Alpha diversity
This folder contains scripts used for processing k-SLAM data to enable alpha diversity calculations. In order of use:
- 1. kslam_xml_to_alphaCounts.py
  - This script will read in a k-SLAM output .xml file and produce a table. Run this script on each individual .xml for the samples.
- 2. kslam_alphaCounts_to_simpson.py
  - This script will read in multiple tables produced by the first script and create a combined table that can be read by VEGAN to perform alpha diversity calculations
- 3. kslam_alphadiv.R
  - This R script will perform the alpha diversity calculation.

## Bubbleplots
This folder contains R scripts used to generate the bubbleplots that form part of this project. A file exists for each of the three metagenome taxonomy prediction programs (kslam, MetaPhlAn2, and QIIME). The input is a NMDS formatted file generated by scripts in the 'NMDS' folder.

## edgerR-GOseq
This folder contains scripts used for generating a read count table used by edgeR, and scripts used subsequent to this to perform edgeR and GOseq analysis. In order of use:
- 1. cluster_read_counts.py
  - This script will read in a cdhit .clstr file and htseq output file and clusters reads from redundant mappings into a single count corresponding to the representative sequence from each cluster. Perform this for each sample. This serves as a precursor to:
- 2. clustered_read_counts_combine.py
  - This script reads in the files generated by the first script and formats a single table that can be used by edgeR to find differentially abundant genes.
- 3. edgeR_logfc.R
  - This script will perform each pairwise comparison and generate output files that can be used for later GOseq.
- 4. antarctica_goseq.R
  - This script will automatically find enriched/depleted annotation terms based upon input mapping files (i.e., GO, Pfam, FOAM, and Resfams) for each pairwise comparison.
- 5. antarctica_goseqfdr_corr.R
  - This script will read in the outputs generated by the previous R script, enforce a FDR cut-off, and generate outputs that can be used by the signature terms script.
- 6. goseq_signature_terms.py
  - This script analyses a directory containing tab-delimited text files of all pairwise comparisons of treatments generated by the previous script. A user specified FDR value can be used as a cut-off.

## k-SLAM data formatting
This folder contains scripts used for formatting k-SLAM data which acts as a precursor to some other analyses. In order of use:
- 1. kslam_xml_taxIdMap.py
  - This script will read in the kslam xml output file and create a tab-delimited text file that can be used for further downstream ktImportText Krona plot generation or NMDS plot generation.
- 2. kslam_taxIdMap_to_ktImportText.py
  - This script reads in the output(s) of kslam_xml_taxIdMap.py and formats file(s) that can be called by ktImportText to produce Krona plot(s).

## NMDS
This folder contains scripts used for generating NMDS tables, and for perform NMDS computation and plotting. For most of these scripts, you will need a full NCBI taxonomy file. I used the script "generate_taxonomy_taxid.py" provided as part of the MetaPalette repository (https://github.com/dkoslicki/MetaPalette). In the case that this repository is closed in the future, I have also added the script to this folder. In order of use:
### k-SLAM
- 1. kslam_taxIdMap_to_nmds.py
  - This script reads in the output(s) of kslam_xml_taxIdMap.py and formats a file that can be read in to VEGAN in R.
- 2. kslam_nmds.R
  - Creates NMDS plots based upon NMDS formatted table file from above script. The outputs are intended to be created as PDFs to be edited in Illustrator manually to organise the labels optimally.

### METAPHLAN2
- 1. metaphlan2_to_nmds.py
  - This script reads in the output(s) of MetaPhlAn2 and formats a file that can be read in to VEGAN in R.
  - Use the kslam_nmds.R script for the actual NMDS plotting.

### QIIME
- 1. qiime_table_to_nmds.py
  - This script will read in a QIIME table file (originating from the summarize_taxa_through_plots.py script or equivalent) and create a table that is amenable to NMDS.
- 2. qiime_nmds.R
  - Creates NMDS plots based upon NMDS formatted table file from above script. The outputs are intended to be created as PDFs to be edited in Illustrator manually to organise the labels optimally.

Also provided is qiime_table_to_nmds_keepPrev.py. This was helpful for manual inspection of results to see what the higher taxonomy levels were for each prediction.

## QIIME data formatting
This folder contains a single script.
- 1. qiime_to_ktImportText.py
  - This script will read in a QIIME table file (originating from the summarize_taxa_through_plots.py script or equivalent) and create a text file that is amenable to ktImportText to produce Krona plot(s).

## Statistcis and helper scripts
This folder includes scripts that were used for performing bastic statistical tests, as well as for analysing the overall results.
- 1. anova_tukeys_stats.R
  - This script will compute ANOVA and Tukey's HSD for input files.
- 2. nmds_convenience.py
  - This script was made quickly just to provide assistance with parsing a NMDS file. It will pull apart a NMDS file and put sorted columns of taxa abundance into your clipboard which can be pasted into Excel/an equivalent program. Data in this format can be used by the below script.
- 3. top_taxa_kslam_multicol.py


### Read count clustering
*cluster_read_counts.py*

This program reads in a cdhit .clstr file and htseq output file and clusters reads from redundant mappings into a single count corresponding to the representative sequence from each cluster. This script is intended as a precursor to the *clustered_read_counts_combine.py* script which will take individually clustered files and create a table that edgeR can read. This script is likely to be a bit heavy on memory depending on file size. 

*clustered_read_counts_combine.py*

This program reads in a group of clustered read counts files originating from the *cluster_read_counts.py* script and converts this into a table that is readable by edgeR. As with the previous script, this could be memory intensive depending on file sizes.

## GOseq related
### Signature terms from GOseq
*goseq_signature_terms.py*

This script analyses a directory containing tab-delimited text files of all pairwise comparisons of treatments. These files must contain two columns, where column 1 contains functional terms, and column 2 contains the associated FDR/P-values for these. The file's header will be ignored if it is present. The script is also able to have a FDR/P-value cut-off enforced when obtaining signature terms.

## QIIME related
### NMDS table creation
*qiime_table_to_nmds.py*

This program will read in the table files QIIME creates from the taxa_summary_plots script and reformat this data into a table that can be read into R and VEGAN.

### Krona file formatting
*qiime_to_ktImportText.py*

This program will read in the table files QIIME creates from the taxa_summary_plots script and reformat this data into a table that can be read by ktImportText to produce Krona plots.

## k-SLAM related
### File preparation for downstream analysis
*kslam_xml_taxIdMap.py*

This program will read in the xml files k-SLAM produces and create a tab-delimited file that can be used for later Krona or NMDS plot generation. Note that the main benefit of producing a Krona plot through this avenue (rather than by using ktImportTaxonomy) is that file size can be significantly reduced. The plot is not as well-formatted as the one ktImportTaxonomy produces by default, however.

### NMDS table creation
*kslam_taxIdMap_to_nmds_group.py*

Reads in the output(s) of *kslam_xml_taxIdMap.py* to produce a tab-delimited file that can be read into R and used by VEGAN to produce NMDS plots. The taxonomic rank to summarise abundances to can be specified if a NMDS at the deepest rank assigned by k-SLAM is not wanted. This script requires a **full** taxonomy file (possibly produced by MetaPalette's generate_taxonomy_taxid.py script).

### Krona file formatting
*kslam_taxIdMap_to_ktImportText.py*

Reads in the output(s) of *kslam_xml_taxIdMap.py* to produce tab-delimited file(s) that can be called by ktImportText to produce Krona plots. This script requires a **full** taxonomy file (possibly produced by MetaPalette's generate_taxonomy_taxid.py script).
